{% extends 'main/header.html' %}
{% load static %}


{% block nav %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css" />
<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<div class="nav">

  <div class="nav_wrap">
    <p>  
      <div class="hit_border">
        <p class="top_title"> <b>â€» ì¡°íšŒìˆœ TOP 3 â€»</b> </p>
          <div class="hit_top3">
            {% for i in "x"|rjust:"3" %}
          <div class="Rank_{{forloop.counter}}">
          <div class="Rank">
            <div class="Rank_img">
              <div class="ranking_num"></div>
              <img id="Rank_{{forloop.counter}}" class="Rank_imgPreview" src="https://i.pinimg.com/originals/c4/cb/9a/c4cb9abc7c69713e7e816e6a624ce7f8.gif">
            </div>
            <div class="Rank_data">
              <div class="Rank_title"></div>
              <div class="Rank_writer">
                <img class="profile_img" src="#">
                <span class="Rank_writer_name"></span>
              </div><br>
              <div class="hitLikesIcons">
                <i class="bi bi-eye-fill"></i> <span class="Rank_views"></span>
                â¤ <span class="Rank_likes"></span>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      </div>
      <br>
  
      <div class="like_border">
      <p class="top_title"> <b>â€» ì¢‹ì•„ìš” TOP 3 â€»</b> </p>
      <div class="likes_top3">
        {% for i in "x"|rjust:"3" %}
        <div class="Rank_{{forloop.counter}}">
          <div class="Rank">
            <div class="Rank_img">
              <div class="ranking_num"></div>
              <img id="Rank_{{forloop.counter}}" class="Rank_imgPreview" src="https://i.pinimg.com/originals/c4/cb/9a/c4cb9abc7c69713e7e816e6a624ce7f8.gif">
            </div>
            <div class="Rank_data">
              <div class="Rank_title"></div>
              <div class="Rank_writer">
                <img class="profile_img" src="#">
                <span class="Rank_writer_name"></span>
              </div><br>
              <div class="hitLikesIcons">
                â¤ <span class="Rank_likes"></span>
                <i class="bi bi-eye-fill"></i> <span class="Rank_views"></span>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
  
    </div>
  </div>
  </div>
<script>
  $(function(){
    // ì¡°íšŒìˆœ TOP 3
    $.ajax({
      url : '{% url "b_hit_top3" %}', 
      type : 'get',
      success : function(hit_top3){
        for(rank=1; rank<4; rank++){
          if("overlap" in hit_top3[rank]){  // ì¤‘ë³µì´ë©´
            $(".hit_top3 .Rank_"+rank+" .Rank .ranking_num").html("<b>"+(rank-1)+"</b>")
          }else{
            $(".hit_top3 .Rank_"+rank+" .Rank .ranking_num").html("<b>"+rank+"</b>")
          }
          /*$(".hit_top3 .Rank_"+rank+" .Rank .Rank_imgPreview").attr("src", "{% static 'image/175125-ì´ê²½ë¬¸ìˆœëŒ€ê³±ì°½.jpg' %}")*/
          $(".hit_top3 .Rank_"+rank+" .Rank .Rank_imgPreview").attr("src", "/static/image/"+hit_top3[rank].filename)
          /* íŒŒì¼ì„ ì„œë²„ë¡œ ë³´ë‚´ì„œ ì„œë²„ê°€ í•´ì„í• ë•Œ % static % ê²½ë¡œë¥¼ ë³´ë‚´ë²„ë¦¬ë©´, static ê²½ë¡œë¡œ ë°›ì•„ë“¤ì—¬ì„œ ì„œë²„ê°€ ê²½ë¡œ í•´ì„ì„ ì´ë¯¸ í•´ë²„ë¦¼
           ë”°ë¼ì„œ static ê²½ë¡œë¡œ í•´ì„ë˜ì§€ ì•Šë„ë¡ ê²½ë¡œ ì „ì²´ë¥¼ ë³€ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ ë³´ë‚´ì¤˜ì•¼í•¨.*/
          
          $(".hit_top3 .Rank_"+rank+" .Rank #Rank_"+rank).attr('value', hit_top3[rank].id);  // í•´ë‹¹ ì•„ì´ë””ì— valueì†ì„±(í•´ë‹¹ì‚¬ì§„ì˜ idê°’) ì¶”ê°€í•´ì£¼ê¸°

          $(".hit_top3 .Rank_"+rank+" .Rank .Rank_imgPreview").click( // í´ë¦­í•˜ë©´ ì´ë¯¸ì§€ ë°œìƒ
            function(e){  // ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ê°ì²´ë¥¼ ë°›ì•„ì˜´
              location.href="detail/"+e.target.getAttribute('value')  // ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ targetì˜ vlaue ì†ì„±ì„ ë°›ì•„ì˜´
            })
          // error ì´ìœ  : .click(location.href="detail/"+ê²½ë¡œ) ë¡œ ì ìœ¼ë©´ clickì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„ì‹œí‚¤ëŠ” ê³¼ì •ì— ë°”ë¡œ location.hrefë¥¼ ì‹¤í–‰í•´ë²„ë¦¼
          //        ==> .click(function(){location.href="detail/"+ê²½ë¡œ}) ë¡œ ì‘ì„±í•´ì„œ clickì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„í• ë•Œ functionì„ ì¤€ë¹„í•˜ê³ , clickì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ functionì´ ì‹¤í–‰ë˜ë„ë¡ ì²˜ë¦¬

          
          $(".hit_top3 .Rank_"+rank+" .Rank .Rank_title").html("<b>"+hit_top3[rank].title+"</b>")
          if(hit_top3[rank].profile == ""){
            $(".hit_top3 .Rank_"+rank+" .Rank .profile_img").attr("src", "/static/image/DONOTDELETE_DY/profile.jpg")
          }else{
            $(".hit_top3 .Rank_"+rank+" .Rank .profile_img").attr("src", "/static/image/"+hit_top3[rank].profile)
          }
          $(".hit_top3 .Rank_"+rank+" .Rank .Rank_writer_name").html(hit_top3[rank].username)
          $(".hit_top3 .Rank_"+rank+" .Rank .Rank_views").text(hit_top3[rank].hit)
          $(".hit_top3 .Rank_"+rank+" .Rank .Rank_likes").text(hit_top3[rank].likes)
        }
      },error : function(){
        console.log("hit_TOP_3 ì—ëŸ¬ë°œìƒ")
      }
    })
    
    // ì¢‹ì•„ìš” TOP 3
    $.ajax({
      url : "{% url 'b_likes_top3' %}",
      type : "get",
      success : function(likes_top3){
        for(rank=1; rank<4; rank++){
          if("overlap" in likes_top3[rank]){  // ì¤‘ë³µì´ë©´
            $(".likes_top3 .Rank_"+rank+" .Rank .ranking_num").html("<b>"+(rank-1)+"</b>")
          }else{
            $(".likes_top3 .Rank_"+rank+" .Rank .ranking_num").html("<b>"+rank+"</b>")
          }
          $(".likes_top3 .Rank_"+rank+" .Rank .Rank_imgPreview").attr("src", "/static/image/"+likes_top3[rank].filename)
          
          $(".likes_top3 .Rank_"+rank+" .Rank #Rank_"+rank).attr('value', likes_top3[rank].id)
          $(".likes_top3 .Rank_"+rank+" .Rank .Rank_imgPreview").click(
            function(e){
              location.href="detail/"+e.target.getAttribute('value')
            })

          $(".likes_top3 .Rank_"+rank+" .Rank .Rank_title").html("<b>"+likes_top3[rank].title+"</b>")
          //console.log("likes_top3["+rank+"].profile : ", likes_top3[rank].profile)
          if(likes_top3[rank].profile == ""){
            $(".likes_top3 .Rank_"+rank+" .Rank .profile_img").attr("src", "/static/image/DONOTDELETE_DY/profile.jpg")
          }else{
            $(".likes_top3 .Rank_"+rank+" .Rank .profile_img").attr("src", "/static/image/"+likes_top3[rank].profile)
          }
          $(".likes_top3 .Rank_"+rank+" .Rank .Rank_writer_name").html(likes_top3[rank].username)
          $(".likes_top3 .Rank_"+rank+" .Rank .Rank_views").text(likes_top3[rank].hit)
          $(".likes_top3 .Rank_"+rank+" .Rank .Rank_likes").text(likes_top3[rank].likes)
        }
      },error : function(){
        console.log("likes_TOP_3 ì—ëŸ¬ë°œìƒ")
      }
    })
  })
</script>
{% endblock nav %}

{% block section %}
<head>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css" />
</head>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

<style>
    .b_radio {
      display: flex;
      float: right;
      margin-right: 70px;
      margin-bottom: 10px;
      text-shadow: 1px 1px 1px gray;
    }

    .board_orderby_base{
      width: 700px;
      height: 190px;
      margin : auto;
      display : flex;
      /* flex-wrap : wrap; */
    }

    .board_imgWindow {
      width: 615px;
      left: 35px;
      overflow : hidden;
      position: relative;
      border-radius: 10px;
      box-shadow: 5px 5px 5px gray;
    }

    .board_views{
        display : flex;
        left: 0px;
        position: relative;
        padding: 0;
    }

    .orderby_image{
        width: 180px;
        margin: 0 4pt;
    }

    .b_one {
        box-shadow: 5px 5px 5px gray;
        border: 0;
    }

    .write {
        position: relative;
        display: block;
        left: 590px;
        margin-top: 60px;
    }

    .hr {
        width: 90%;
        left: 6%; 
        position: relative;
    }

</style>

<div class ="b_radio">
    <div class="form-check">
      <span id="testid" style="cursor: pointer;" onclick="b_listArray('id')" href="#"><b>ì—…ë°ì´íŠ¸ìˆœ&nbsp;&nbsp;</b></span>
    </div>
    <div class="form-check">
      <span id="testlikes" style="cursor: pointer;" onclick="b_listArray('likes')" href="#"><b>ì¢‹ì•„ìš”ìˆœ&nbsp;&nbsp;</b></span>
    </div>
    <div class="form-check">
      <span id="testhit" style="cursor: pointer;" onclick="b_listArray('hit')" href="#"><b>ì¡°íšŒìˆœ&nbsp;&nbsp;</b></span>
    </div>
</div>

<div class="b_base">
  <div class = "board_orderby_base">
    {# <i class="order_rightBtn bi bi-arrow-left-square" onclick="oder_preBtn()" style="font-size: xx-large;" ></i> #}
    <div class="board_imgWindow">
      <ul class = "board_views">
        {# ì´ë¯¸ì§€ list ë“¤ì–´ê° #}
        {# <img class="orderby_image"> #}
      </ul>
    </div>

    {# <i class="order_leftBtn bi bi-arrow-right-square" onclick="order_nextBtn()" style="font-size: xx-large;"></i> #}
  </div>

  <script>

    b_listArray('id')   // ì²˜ìŒì—ëŠ” ì—…ë°ì´íŠ¸ ìˆœ ì •ë ¬ë˜ì–´ìˆìŒ
    var totalSlides = 0   //ê²Œì‹œê¸€ ê°¯ìˆ˜

    function b_listArray(criterion){  // ì •ë ¬ê¸°ì¤€ë”°ë¼ ì „ì†¡ => rest_viewsì—ì„œ order_byë¡œ ì •ë ¬í•¨
      //event.preventDefault()
      //event.stopPropagation()
      $(".board_views").finish()  // í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì—ë‹ˆë©”ì´ì…˜(í•¨ìˆ˜) ì¤‘ì§€ + ëŒ€ê¸°ì¤‘ì¸ ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜(í•¨ìˆ˜) ì œê±° + ì„ íƒìš”ì†Œì— ëŒ€í•œ ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜ì„ ì™„ë£Œë¡œ
      $(".board_views").css("left", "20px")  // ìŠ¬ë¼ì´ë“œë°” ì›ìœ„ì¹˜
      slideIndex = 0
      $.ajax({
        url : "{% url 'b_list_array' %}",
        type : "GET", 
        data : {"criterion" : criterion}, 
        success : function(jsonData){
            totalSlides = jsonData['data'].length
            console.log("totalSlides : ", totalSlides)
            let b_list_html = ""
            for(i=0;i<jsonData['data'].length;i++){
                b_list_html += '<img class="orderby_image" src="/static/image/'+jsonData["data"][i]["fields"]["file_name"]+'" onclick="location.href=\'detail/'+jsonData["data"][i]["pk"]+'\'" >'
            }
            $(".board_views").html(b_list_html)
            setTimeout(showSlides(totalSlides), 1000)  // ë¡œë”©ë˜ë©´ 2ì´ˆ(2000) ê¸°ë‹¤ë ¸ë‹¤ê°€ ì‹œì‘
                $("#testid").css("color","#000000");
                $("#testlikes").css("color","#000000");
                $("#testhit").css("color","#000000");
                $("#test"+criterion).css("color","#FFAC1C");
            },error : function(){
            console.log("b_listArray ì—ëŸ¬ë°œìƒ")
            }   
      })
    }
  
    // ìë™ ìŠ¬ë¼ì´ë“œ ë§Œë“¤ê¸°
    var slideIndex = 1
    var slideWidth = 190   // ì‚¬ì§„ ë„ˆë¹„ë§Œí¼
  
    function showSlides(totalSlides){
      console.log("slideIndex : ", slideIndex)
      console.log("slideWidth*slideIndex : ", slideWidth*slideIndex)
  
      if(slideIndex == 0){
        $(".board_views").animate({"left": 20-(slideWidth*slideIndex) + 'px'})
      }else{
        $(".board_views").animate({"left": 20-(slideWidth*slideIndex) + 'px'}, 3000)
      }
      slideIndex++;
      if (slideIndex === totalSlides-2) { // ë§ˆì§€ë§‰ê¹Œì§€ ì˜¤ë©´
          slideIndex = 0   // ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°
      }
      if(slideIndex == 0){
        setTimeout(showSlides, 0)  // ë°€ë¦¬ì´ˆë¥¼ ê¸°ë‹¤ë¦° í›„ì— í•¨ìˆ˜ ì‹¤í–‰(5ì´ˆ:5000)
      }else{
        setTimeout(showSlides, 4000)  // ë°€ë¦¬ì´ˆë¥¼ ê¸°ë‹¤ë¦° í›„ì— í•¨ìˆ˜ ì‹¤í–‰(5ì´ˆ:5000)
        // ì´ì‹œê°„ 5ì´ˆ - ì‚¬ì§„ ë„˜ê¸°ëŠ”ê±° 3ì´ˆ => delayê°€ 2ì´ˆì²˜ëŸ¼ ë³´ì„
      }
    }
  
  </script>
  <br>
  <hr class="hr">

  <button type="button" class="write btn btn-outline-secondary" onclick="location.href='/board/write'">ğŸ–‹ ê¸€ì‘ì„±</button>
  <div class="b_list">
    {% for s in data%}
    {% for i,k in s.items %}
    <div class="b_one">
      <div class="b_image">
        <img class="b_image" src="{% url 'download' i.file_name %}" onclick="location.href='detail/{{i.id}}'" >
      </div>

      <div class="b_one_title">
      
        <i class="bi bi-caret-right-square"></i><b><font size='4'> ê°€ê²Œì´ë¦„ : {{i.title}}</font></b></i><br>
        ì‘ì„±ë‚ ì§œ : {{i.save_date}}<br>
        ì‘ì„±ì :
        {% if i.user_id.profile == "" %}
          <img class="profile_img" src="/static/image/DONOTDELETE_DY/profile.jpg">
        {% else %}
          <img class="profile_img" src="/static/image/{{i.user_id.profile}}">
        {% endif %}

        {{i.user_id}}<br>
        <i class="bi bi-eye-fill">{{i.hit}}</i>
          ğŸ–¤{{i.likes.count}}
        <i class="bi bi-chat-right-text-fill"> {{k}}</i>
      </div>
    </div>
    {% endfor %}
    {% endfor %}
  </div>

  <nav aria-label="Page navigation example">
    <ul class="pagination">
      <li class="page-item">
        {%if data.has_previous%}
        <a class="page-link" href="?start={{data.previous_page_number}}" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          {%else%}
          <a class="page-link" href="#" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
          {%endif%}
        </a>
      </li>
      {%for i in data.paginator.page_range%}
      <li class="page-item"><a class="page-link" href="?start={{i}}">{{forloop.counter}}</a></li>
        {%endfor%}
        
        <li class="page-item">
          {%if data.has_next%}
          <a class="page-link" href="?start={{data.next_page_number}}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            {%else%}
            <a class="page-link" href="#" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
            {%endif%}
          </a>
        </li>
      </li>
    </ul>
  </nav> 

<script>
  const csrftoken = Cookies.get('csrftoken')
  function setHart(id, num, user){
    if( user == 'AnonymousUser' ){
        alert('ë¡œê·¸ì¸ ë¨¼ì € ì§„í–‰í•˜ì„¸ìš”')
        location.href = '/member/login'
        return 
    }
    $.ajax({
        url : "{% url 'b_like' %}", type : "put",
        data : {"num":num },
        headers : {'X-CSRFToken':csrftoken} ,
        success : function(dict_likes){
            if(dict_likes.likes == 0 ) h = 'â¤'
            else h = 'ğŸ–¤'
            $("#hart"+id).html( h )
            $("#likes_cnt"+id).html(dict_likes.likes_cnt)
        }
    })
  }
</script>

</div>
{% endblock section %}



{% block aside %}
<div class="aside">
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a940651331fabaff83a25f635f19530f&libraries=services"></script>   <!-- kakao map API key -->
<style>
  #placesList {
    width: 150px;

  }
</style>
<div class="map_wrap">
  <b style="text-align: center; color: burlywood; font-size: 13pt;">ê°€ê³ ì‹¶ì€ ì¥ì†Œë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”&nbsp;<i class="bi bi-search" style="font-size: 21pt;"></i></b>
  
  <div id="map"></div>

  <div id="menu_wrap" class="bg_white">
      <div class="option">
          <div>
              <form onsubmit="searchPlaces(); return false;">
                  í‚¤ì›Œë“œ : <input type="text" value="ì¢…ë¡œ3ê°€ ë§›ì§‘" id="keyword" size="15"> 
                  <button type="submit">ê²€ìƒ‰í•˜ê¸°</button> 
              </form>
          </div>
      </div>
      <hr>
      <div>
        <div id="placesList"></div>
        <div id="map_pagination"></div>
      </div>
  </div>
</div>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a940651331fabaff83a25f635f19530f&libraries=services"></script>
<script>
// ë§ˆì»¤ë¥¼ ë‹´ì„ ë°°ì—´ì…ë‹ˆë‹¤
var markers = [];

var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
    mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
    };  

// ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
var map = new kakao.maps.Map(mapContainer, mapOption); 

// ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var ps = new kakao.maps.services.Places();  

// ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì´ë‚˜ ë§ˆì»¤ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var infowindow = new kakao.maps.InfoWindow({zIndex:1});

// í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
searchPlaces();

// í‚¤ì›Œë“œ ê²€ìƒ‰ì„ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function searchPlaces() {

    var keyword = document.getElementById('keyword').value;

    if (!keyword.replace(/^\s+|\s+$/g, '')) {
        alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return false;
    }

    // ì¥ì†Œê²€ìƒ‰ ê°ì²´ë¥¼ í†µí•´ í‚¤ì›Œë“œë¡œ ì¥ì†Œê²€ìƒ‰ì„ ìš”ì²­í•©ë‹ˆë‹¤
    ps.keywordSearch( keyword, placesSearchCB); 
}

// ì¥ì†Œê²€ìƒ‰ì´ ì™„ë£Œëì„ ë•Œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
function placesSearchCB(data, status, map_pagination) {
    if (status === kakao.maps.services.Status.OK) {

        // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
        // ê²€ìƒ‰ ëª©ë¡ê³¼ ë§ˆì»¤ë¥¼ í‘œì¶œí•©ë‹ˆë‹¤
        displayPlaces(data);

        // í˜ì´ì§€ ë²ˆí˜¸ë¥¼ í‘œì¶œí•©ë‹ˆë‹¤
        displayPagination(map_pagination);

    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

        alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;

    } else if (status === kakao.maps.services.Status.ERROR) {

        alert('ê²€ìƒ‰ ê²°ê³¼ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return;

    }
}

// ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ê³¼ ë§ˆì»¤ë¥¼ í‘œì¶œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function displayPlaces(places) {

    var listEl = document.getElementById('placesList'), 
    menuEl = document.getElementById('menu_wrap'),
    fragment = document.createDocumentFragment(), 
    bounds = new kakao.maps.LatLngBounds(), 
    listStr = '';
    
    // ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì— ì¶”ê°€ëœ í•­ëª©ë“¤ì„ ì œê±°í•©ë‹ˆë‹¤
    removeAllChildNods(listEl);

    // ì§€ë„ì— í‘œì‹œë˜ê³  ìˆëŠ” ë§ˆì»¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤
    removeMarker();
    
    for ( var i=0; i<3; i++ ) {

        // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
        var placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
            marker = addMarker(placePosition, i), 
            itemEl = getListItem(i, places[i]); // ê²€ìƒ‰ ê²°ê³¼ í•­ëª© Elementë¥¼ ìƒì„±í•©ë‹ˆë‹¤

        // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
        // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
        bounds.extend(placePosition);

        // ë§ˆì»¤ì™€ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì— mouseover í–ˆì„ë•Œ
        // í•´ë‹¹ ì¥ì†Œì— ì¸í¬ìœˆë„ìš°ì— ì¥ì†Œëª…ì„ í‘œì‹œí•©ë‹ˆë‹¤
        // mouseout í–ˆì„ ë•ŒëŠ” ì¸í¬ìœˆë„ìš°ë¥¼ ë‹«ìŠµë‹ˆë‹¤
        (function(marker, title) {
            kakao.maps.event.addListener(marker, 'mouseover', function() {
                displayInfowindow(marker, title);
            });

            kakao.maps.event.addListener(marker, 'mouseout', function() {
                infowindow.close();
            });

            itemEl.onmouseover =  function () {
                displayInfowindow(marker, title);
            };

            itemEl.onmouseout =  function () {
                infowindow.close();
            };
        })(marker, places[i].place_name);

        fragment.appendChild(itemEl);
    }

    // ê²€ìƒ‰ê²°ê³¼ í•­ëª©ë“¤ì„ ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ Elementì— ì¶”ê°€í•©ë‹ˆë‹¤
    listEl.appendChild(fragment);
    menuEl.scrollTop = 0;

    // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
    map.setBounds(bounds);
}

// ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ Elementë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function getListItem(index, places) {

    var el = document.createElement('li'),
    itemStr = '<span class="markerbg marker_' + (index+1) + '"></span>' +
                '<div class="info">' +
                '   <h5>' + places.place_name + '</h5>';

    if (places.road_address_name) {
        itemStr += '    <span>' + places.road_address_name + '</span>' +
                    '   <span class="jibun gray">' +  places.address_name  + '</span>';
    } else {
        itemStr += '    <span>' +  places.address_name  + '</span>'; 
    }
                 
      itemStr += '  <span class="tel">' + places.phone  + '</span>' +
                '</div>';           

    el.innerHTML = itemStr;
    el.className = 'item';

    return el;
}

// ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ ìœ„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function addMarker(position, idx, title) {
    var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // ë§ˆì»¤ ì´ë¯¸ì§€ url, ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ë¥¼ ì”ë‹ˆë‹¤
        imageSize = new kakao.maps.Size(36, 37),  // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ í¬ê¸°
        imgOptions =  {
            spriteSize : new kakao.maps.Size(36, 691), // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ì˜ í¬ê¸°
            spriteOrigin : new kakao.maps.Point(0, (idx*46)+10), // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ ì¤‘ ì‚¬ìš©í•  ì˜ì—­ì˜ ì¢Œìƒë‹¨ ì¢Œí‘œ
            offset: new kakao.maps.Point(13, 37) // ë§ˆì»¤ ì¢Œí‘œì— ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ë‚´ì—ì„œì˜ ì¢Œí‘œ
        },
        markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
            marker = new kakao.maps.Marker({
            position: position, // ë§ˆì»¤ì˜ ìœ„ì¹˜
            image: markerImage 
        });

    marker.setMap(map); // ì§€ë„ ìœ„ì— ë§ˆì»¤ë¥¼ í‘œì¶œí•©ë‹ˆë‹¤
    markers.push(marker);  // ë°°ì—´ì— ìƒì„±ëœ ë§ˆì»¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤

    return marker;
}

// ì§€ë„ ìœ„ì— í‘œì‹œë˜ê³  ìˆëŠ” ë§ˆì»¤ë¥¼ ëª¨ë‘ ì œê±°í•©ë‹ˆë‹¤
function removeMarker() {
    for ( var i = 0; i < markers.length; i++ ) {
        markers[i].setMap(null);
    }   
    markers = [];
}

// ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ í•˜ë‹¨ì— í˜ì´ì§€ë²ˆí˜¸ë¥¼ í‘œì‹œëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function displayPagination(map_pagination) {
    var paginationEl = document.getElementById('map_pagination'),
        fragment = document.createDocumentFragment(),
        i; 

    // ê¸°ì¡´ì— ì¶”ê°€ëœ í˜ì´ì§€ë²ˆí˜¸ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤
    while (paginationEl.hasChildNodes()) {
        paginationEl.removeChild (paginationEl.lastChild);
    }

    for (i=1; i<=map_pagination.last; i++) {
        var el = document.createElement('a');
        el.href = "#";
        el.innerHTML = i;

        if (i===map_pagination.current) {
            el.className = 'on';
        } else {
            el.onclick = (function(i) {
                return function() {
                  map_pagination.gotoPage(i);
                }
            })(i);
        }

        fragment.appendChild(el);
    }
    paginationEl.appendChild(fragment);
}

// ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ ë˜ëŠ” ë§ˆì»¤ë¥¼ í´ë¦­í–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
// ì¸í¬ìœˆë„ìš°ì— ì¥ì†Œëª…ì„ í‘œì‹œí•©ë‹ˆë‹¤
function displayInfowindow(marker, title) {
    var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

    infowindow.setContent(content);
    infowindow.open(map, marker);
}

 // ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ì˜ ìì‹ Elementë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function removeAllChildNods(el) {   
    while (el.hasChildNodes()) {
        el.removeChild (el.lastChild);
    }
}
</script>
</div>
{% endblock aside %}